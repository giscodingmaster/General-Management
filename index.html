<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>نظام إدارة عمليات غاز مصر - عرض تقديمي</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Import Map (FIXED: Removed React 19 conflict) -->
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.330.0",
    "recharts": "https://esm.sh/recharts@2.12.7?external=react,react-dom",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
  }
}
</script>
  
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; overflow: hidden; }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    /* Animations */
    .animate-in { animation: fadeIn 0.5s ease-out forwards; }
    .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useMemo } from 'react';
    import { createRoot } from 'react-dom/client';
    import { 
      LayoutDashboard, ClipboardList, Settings, Menu, Map as MapIcon, ChevronDown, Calendar,
      Sparkles, Save, X, Search, Users, Truck, Briefcase, Car, Ban,
      Lock, Unlock, Filter, Building, MapPin, XCircle, Clock, Check, 
      Trophy, Medal, Crown, Activity, AlertTriangle, FileBarChart, Zap, Loader2,
      TrendingUp, ArrowRightLeft, Target, List, ArrowUpRight, FileText, Navigation, CheckSquare, Square,
      Plus, Trash2, Edit2, User, Hammer 
    } from 'lucide-react';
    
    import { 
      PieChart, Pie, Cell, ResponsiveContainer, Tooltip as RechartsTooltip, AreaChart, Area, XAxis, YAxis, CartesianGrid 
    } from 'recharts';

    // --- MOCK DATA FOR PROPOSAL ---
    const AREAS = [
      { id: 'Cairo', name: 'القاهرة' },
      { id: 'Gharbia', name: 'الغربية' },
      { id: 'Dakahlia', name: 'الدقهلية' },
      { id: 'Alexandria', name: 'الإسكندرية' },
    ];

    const INITIAL_EMPLOYEES = [
      { id: '1', name: 'أحمد سليمان', role: 'مهندس أول', department: 'Company', avatar: 'https://i.pravatar.cc/150?u=1', status: 'OFFICE', areaId: 'Cairo' },
      { id: '2', name: 'وليد محي', role: 'مسّاح', department: 'Institute', avatar: 'https://i.pravatar.cc/150?u=2', status: 'ABSENT', areaId: 'Cairo' },
      { id: '3', name: 'أشرف إبراهيم', role: 'فني تشغيل', department: 'Institute', avatar: 'https://i.pravatar.cc/150?u=3', status: 'SITE', areaId: 'Cairo' },
      { id: '4', name: 'محمد فرج', role: 'سائق', department: 'Company', avatar: 'https://i.pravatar.cc/150?u=4', status: 'SITE', areaId: 'Cairo' },
      { id: '5', name: 'ندى سامح', role: 'مدير عمليات', department: 'Company', avatar: 'https://i.pravatar.cc/150?u=5', status: 'OFFICE', areaId: 'Cairo' },
      { id: '6', name: 'خالد علي', role: 'مسؤول سلامة', department: 'Institute', avatar: 'https://i.pravatar.cc/150?u=6', status: 'OFFICE', areaId: 'Gharbia' },
      { id: '7', name: 'ياسر عمر', role: 'فني لحام', department: 'Company', avatar: 'https://i.pravatar.cc/150?u=7', status: 'SITE', areaId: 'Cairo' },
      { id: '8', name: 'رامي سعيد', role: 'مساعد فني', department: 'Institute', avatar: 'https://i.pravatar.cc/150?u=8', status: 'SITE', areaId: 'Cairo' },
    ];

    // --- COMPONENT: EmployeeRow ---
    const EmployeeRow = ({ employee, onChangeStatus, isBusy, busyTaskTitle, isOverride }) => {
      const disabled = isBusy && !isOverride;

      return (
        <div className={`group relative flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-white border border-slate-100 rounded-2xl shadow-sm mb-3 transition-all duration-300 hover:shadow-md hover:border-blue-100 ${disabled ? 'opacity-60 bg-slate-50' : ''}`}>
          <div className="flex items-center gap-4 mb-3 sm:mb-0">
            <div className="relative shrink-0">
                 <div className={`w-12 h-12 rounded-2xl overflow-hidden border-2 transition-colors ${isBusy ? 'border-amber-300 grayscale' : 'border-white shadow-sm'}`}>
                    <img src={employee.avatar} alt={employee.name} className="w-full h-full object-cover" />
                 </div>
                 {isBusy && (
                     <div className="absolute -bottom-1 -right-1 bg-amber-100 text-amber-600 rounded-full p-1 border-2 border-white shadow-sm z-10">
                         <Clock size={10} strokeWidth={3} />
                     </div>
                 )}
                 <div className={`absolute top-0 right-0 w-3.5 h-3.5 rounded-full border-2 border-white shadow-sm transition-colors duration-300 ${
                     employee.status === 'SITE' ? 'bg-blue-500' : 
                     employee.status === 'OFFICE' ? 'bg-amber-500' : 'bg-red-500'
                 }`}></div>
            </div>
            
            <div>
              <h4 className={`font-bold text-slate-800 flex items-center gap-2 ${isBusy ? 'text-slate-600' : ''}`}>
                {employee.name}
                {isBusy && <span className="px-2 py-0.5 rounded-full bg-amber-50 text-amber-700 text-[10px] font-bold border border-amber-100 whitespace-nowrap">في مهمة</span>}
              </h4>
              <p className="text-xs text-slate-500 mt-0.5 font-medium flex items-center gap-1.5">
                {employee.role} <span className="w-1 h-1 bg-slate-300 rounded-full"></span> {employee.department === 'Company' ? 'الشركة' : 'المعهد'}
              </p>
              {isBusy && <p className="text-[10px] text-amber-600 mt-1 font-medium">مشغول في: {busyTaskTitle}</p>}
            </div>
          </div>

          <div className={`p-1.5 bg-slate-100 rounded-xl flex items-center gap-1 sm:w-auto w-full ${disabled ? 'pointer-events-none opacity-50' : ''}`}>
            {['ABSENT', 'OFFICE', 'SITE'].map((status) => (
               <button
                 key={status}
                 onClick={() => onChangeStatus(employee.id, status)}
                 className={`relative flex-1 sm:flex-none px-4 py-2 rounded-lg text-xs font-bold transition-all duration-200 flex items-center justify-center gap-1.5 ${
                   employee.status === status
                     ? (status === 'SITE' ? 'bg-blue-600 text-white shadow-blue-200 shadow-md' : 'bg-white text-slate-800 shadow-sm')
                     : 'text-slate-400 hover:bg-slate-200/50'
                 }`}
               >
                 {status === 'ABSENT' && <XCircle size={14} className={employee.status === 'ABSENT' ? "text-red-500" : ""} />}
                 {status === 'OFFICE' && <Building size={14} className={employee.status === 'OFFICE' ? "text-amber-500" : ""} />}
                 {status === 'SITE' && <MapPin size={14} />}
                 <span>{status === 'ABSENT' ? 'غياب' : status === 'OFFICE' ? 'مكتب' : 'موقع'}</span>
               </button>
            ))}
          </div>
        </div>
      );
    };

    // --- COMPONENT: Report Table (Fixed) ---
    const ReportTable = ({ data }) => {
        return (
            <div className="overflow-x-auto rounded-xl border border-slate-200 animate-in">
                <table className="w-full text-right bg-white">
                    <thead className="bg-slate-50 text-slate-500">
                        <tr>
                            <th className="p-4 text-xs font-bold uppercase">الاسم</th>
                            <th className="p-4 text-xs font-bold uppercase">الوظيفة</th>
                            <th className="p-4 text-xs font-bold uppercase">الحالة</th>
                            <th className="p-4 text-xs font-bold uppercase">وقت الحضور</th>
                            <th className="p-4 text-xs font-bold uppercase">ملاحظات</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-100">
                        {data.map((e) => (
                            <tr key={e.id} className="hover:bg-slate-50 transition-colors">
                                <td className="p-4 text-sm font-bold text-slate-800 flex items-center gap-2">
                                    <div className="w-8 h-8 rounded-full bg-slate-100 overflow-hidden">
                                        <img src={e.avatar} className="w-full h-full object-cover" />
                                    </div>
                                    {e.name}
                                </td>
                                <td className="p-4 text-sm text-slate-600">{e.role}</td>
                                <td className="p-4 text-sm">
                                    <span className={`px-2 py-1 rounded-full text-xs font-bold flex items-center gap-1 w-fit ${
                                        e.status === 'SITE' ? 'bg-blue-100 text-blue-700' :
                                        e.status === 'OFFICE' ? 'bg-amber-100 text-amber-700' :
                                        'bg-red-100 text-red-700'
                                    }`}>
                                        {e.status === 'SITE' ? <MapPin size={10}/> : e.status === 'OFFICE' ? <Building size={10}/> : <XCircle size={10}/>}
                                        {e.status === 'SITE' ? 'موقع ميداني' : e.status === 'OFFICE' ? 'مقر الشركة' : 'غياب'}
                                    </span>
                                </td>
                                <td className="p-4 text-sm font-mono text-slate-500">
                                    {e.status === 'ABSENT' ? '-' : '08:00 ص'}
                                </td>
                                <td className="p-4 text-sm text-slate-500">
                                    {e.status === 'SITE' ? 'مشروع خط شبرا' : '-'}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        );
    };

    // --- COMPONENT: ManagerDashboard ---
    const ManagerDashboard = ({ employees }) => {
      const [showDetailed, setShowDetailed] = useState(false);
      const [loadingReport, setLoadingReport] = useState(false);
      
      const site = employees.filter(e => e.status === 'SITE').length;
      const office = employees.filter(e => e.status === 'OFFICE').length;
      const absent = employees.filter(e => e.status === 'ABSENT').length;
      
      const chartData = [
         {name: 'موقع', value: site, color: '#3B82F6'},
         {name: 'مكتب', value: office, color: '#F59E0B'},
         {name: 'غياب', value: absent, color: '#EF4444'},
      ];

      const handleGenerateTable = () => {
         if(showDetailed) return;
         setLoadingReport(true);
         setTimeout(() => {
             setLoadingReport(false);
             setShowDetailed(true);
         }, 600);
      };

      return (
        <div className="space-y-6 animate-in pb-10">
             {/* Header Cards */}
             <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm flex items-center justify-between">
                    <div>
                        <p className="text-slate-500 text-xs font-bold uppercase mb-1">نسبة الحضور</p>
                        <h2 className="text-3xl font-black text-slate-800">{Math.round(((site + office) / employees.length) * 100)}%</h2>
                    </div>
                    <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center">
                        <Users size={24} />
                    </div>
                </div>
                <div className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm flex items-center justify-between">
                    <div>
                        <p className="text-slate-500 text-xs font-bold uppercase mb-1">فرق ميدانية</p>
                        <h2 className="text-3xl font-black text-emerald-600">{site}</h2>
                    </div>
                    <div className="w-12 h-12 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center justify-center">
                        <TrendingUp size={24} />
                    </div>
                </div>
                <button 
                    onClick={handleGenerateTable}
                    className="bg-gradient-to-br from-indigo-600 to-blue-600 p-6 rounded-3xl shadow-lg shadow-blue-200 text-white flex flex-col justify-between cursor-pointer hover:scale-[1.02] transition-transform text-right"
                >
                    <div className="flex justify-between items-start w-full">
                        <div>
                            <p className="text-blue-100 text-xs font-bold uppercase mb-1">التقارير</p>
                            <h2 className="text-xl font-bold">تقرير التفاصيل</h2>
                        </div>
                        <FileBarChart className="text-blue-200" />
                    </div>
                    <div className="text-xs bg-white/20 w-fit px-2 py-1 rounded-lg mt-4 backdrop-blur-sm flex items-center gap-2">
                       {loadingReport ? <Loader2 size={12} className="animate-spin"/> : <Zap size={12}/>}
                       {loadingReport ? 'جاري التحضير...' : (showDetailed ? 'تم العرض' : 'اضغط للعرض')}
                    </div>
                </button>
             </div>

             {/* Chart & Table Area */}
             <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                {/* Chart */}
                <div className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm h-fit">
                    <h3 className="font-bold text-slate-800 mb-4">توزيع القوى العاملة</h3>
                    <div className="h-64 w-full">
                       <ResponsiveContainer width="100%" height="100%">
                          <PieChart>
                             <Pie 
                                data={chartData} 
                                innerRadius={60} 
                                outerRadius={80} 
                                paddingAngle={5} 
                                dataKey="value"
                             >
                                {chartData.map((entry, index) => (
                                   <Cell key={`cell-${index}`} fill={entry.color} strokeWidth={0} />
                                ))}
                             </Pie>
                             <RechartsTooltip contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)'}} />
                          </PieChart>
                       </ResponsiveContainer>
                    </div>
                    <div className="flex justify-center gap-4 text-xs font-bold text-slate-600 mt-4">
                        <span className="flex items-center gap-1"><span className="w-2 h-2 bg-blue-500 rounded-full"></span> موقع ({site})</span>
                        <span className="flex items-center gap-1"><span className="w-2 h-2 bg-amber-500 rounded-full"></span> مكتب ({office})</span>
                        <span className="flex items-center gap-1"><span className="w-2 h-2 bg-red-500 rounded-full"></span> غياب ({absent})</span>
                    </div>
                </div>

                {/* Report Table View */}
                <div className="lg:col-span-2 bg-white p-6 rounded-3xl border border-slate-100 shadow-sm min-h-[450px] flex flex-col">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="font-bold text-slate-800 flex items-center gap-2">
                            <List size={20} className="text-slate-400"/>
                            بيانات الجدول الزمني
                        </h3>
                        {showDetailed && (
                            <button className="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-lg">
                                تصدير Excel
                            </button>
                        )}
                    </div>
                    
                    <div className="flex-1">
                        {loadingReport ? (
                            <div className="h-full flex flex-col items-center justify-center text-slate-400">
                                <Loader2 size={32} className="animate-spin mb-2 text-blue-500"/>
                                <p>جاري معالجة البيانات...</p>
                            </div>
                        ) : showDetailed ? (
                            <ReportTable data={employees} />
                        ) : (
                            <div className="h-full flex flex-col items-center justify-center text-slate-400 pb-12 border-2 border-dashed border-slate-100 rounded-xl">
                                <FileText size={48} className="mb-4 opacity-20" />
                                <p>اضغط على "تقرير التفاصيل" لعرض البيانات</p>
                            </div>
                        )}
                    </div>
                </div>
             </div>
        </div>
      );
    };

    // --- COMPONENT: App ---
    const App = () => {
      const [view, setView] = useState('MANAGER'); 
      const [employees, setEmployees] = useState(INITIAL_EMPLOYEES);
      const [sidebarOpen, setSidebarOpen] = useState(true);

      const handleStatusChange = (id, newStatus) => {
        setEmployees(prev => prev.map(e => e.id === id ? { ...e, status: newStatus } : e));
      };

      const SidebarItem = ({ icon, label, id }) => (
        <button onClick={() => setView(id)} className={`w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all ${view === id ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/20' : 'text-slate-400 hover:text-white hover:bg-white/5'}`}>
          {icon}
          {sidebarOpen && <span className="text-sm font-medium">{label}</span>}
        </button>
      );

      return (
        <div className="flex h-screen bg-slate-50 overflow-hidden text-slate-800" dir="rtl">
          {/* Sidebar */}
          <aside className={`${sidebarOpen ? 'w-64' : 'w-20'} bg-slate-900 text-white flex flex-col transition-all duration-300 z-50 shadow-2xl`}>
             <div className="p-6 flex items-center gap-3 border-b border-slate-800">
                <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center font-bold shadow-lg shadow-blue-500/50">غ</div>
                {sidebarOpen && <span className="font-bold text-lg tracking-wide">غاز مصر</span>}
             </div>
             
             <div className="p-4">
                 {sidebarOpen && <div className="text-xs text-slate-500 font-bold uppercase mb-2 px-2">القائمة الرئيسية</div>}
                 <nav className="space-y-1">
                    <SidebarItem id="MANAGER" icon={<LayoutDashboard size={20}/>} label="لوحة القيادة" />
                    <SidebarItem id="DISPATCH" icon={<ClipboardList size={20}/>} label="إدارة المهام" />
                 </nav>
             </div>

             <div className="mt-auto p-4 border-t border-slate-800">
                <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center font-bold border border-slate-600">م</div>
                    {sidebarOpen && (
                        <div>
                            <div className="text-sm font-bold">المدير العام</div>
                            <div className="text-xs text-slate-500">مشرف النظام</div>
                        </div>
                    )}
                </div>
             </div>
          </aside>

          {/* Main Content */}
          <main className="flex-1 flex flex-col h-screen overflow-hidden relative bg-slate-50">
             <header className="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 sticky top-0 z-40 shadow-sm">
                <div className="flex items-center gap-4">
                    <button onClick={() => setSidebarOpen(!sidebarOpen)} className="p-2 hover:bg-slate-100 rounded-lg transition-colors"><Menu size={20}/></button>
                    <h1 className="font-bold text-lg text-slate-800">فرع القاهرة - قطاع العمليات</h1>
                </div>
                <div className="flex items-center gap-2">
                    <span className="bg-emerald-50 text-emerald-700 px-3 py-1.5 rounded-lg text-xs font-bold border border-emerald-100 flex items-center gap-2">
                        <span className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                        متصل (تجريبي)
                    </span>
                </div>
             </header>
             
             <div className="flex-1 overflow-auto p-4 md:p-8">
               {view === 'MANAGER' && <ManagerDashboard employees={employees} />}
               
               {view === 'DISPATCH' && (
                 <div className="max-w-5xl mx-auto space-y-6 animate-in">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-slate-900">توزيع المهام والفريق</h2>
                        <button className="bg-blue-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 transition-all flex items-center gap-2">
                            <Save size={18} /> حفظ التغييرات
                        </button>
                    </div>
                    
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <div className="flex items-center justify-between mb-6">
                            <div className="flex items-center gap-2 text-slate-700">
                                <Users size={20} className="text-blue-600"/>
                                <h3 className="font-bold text-lg">قائمة الموظفين</h3>
                            </div>
                            <span className="text-xs font-bold bg-slate-100 text-slate-600 px-2 py-1 rounded-lg">{employees.length} موظف</span>
                        </div>
                        
                        <div className="space-y-2">
                            {employees.map(emp => (
                                <EmployeeRow 
                                    key={emp.id} 
                                    employee={emp} 
                                    onChangeStatus={handleStatusChange}
                                    isBusy={emp.id === '1' || emp.id === '4'} // Demo busy state
                                    busyTaskTitle="صيانة خط شبرا"
                                />
                            ))}
                        </div>
                    </div>
                 </div>
               )}
             </div>
          </main>
        </div>
      );
    };

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
